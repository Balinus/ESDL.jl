<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Accessing the Data Cube · CABLAB.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Ubuntu+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="assets/documenter.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="../versions.js"></script></head><body><nav class="toc"><h1>CABLAB.jl</h1><form class="search" action="search.html"><select id="version-selector" onChange="window.location.href=this.value"><option value="#" selected="selected" disabled="disabled">Version</option></select><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">Home</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="thecube.html">The CABLAB Data Cube</a></li><li class="current"><a class="toctext" href="cube_access.html">Accessing the Data Cube</a><ul class="internal"><li><a class="toctext" href="#Open-a-datacube-1">Open a datacube</a></li><li><a class="toctext" href="#Getting-a-data-handle-1">Getting a data handle</a></li><li><a class="toctext" href="#Cube-Types-1">Cube Types</a></li><li><a class="toctext" href="#Cube-Axes-1">Cube Axes</a></li><li><a class="toctext" href="#Cube-Masks-1">Cube Masks</a></li><li><a class="toctext" href="#Opening-Remote-Data-Cubes-1">Opening Remote Data Cubes</a></li><li><a class="toctext" href="#Point-wise-access-1">Point-wise access</a></li></ul></li><li><a class="toctext" href="analysis.html">Analysis</a></li><li><a class="toctext" href="plotting.html">Plotting</a></li><li><a class="toctext" href="adding_new.html">Applying custom functions</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href="cube_access.html">Accessing the Data Cube</a></li></ul><a class="edit-page" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/docs/src/cube_access.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/></header><h1><a class="nav-anchor" id="Accessing-the-Data-Cube-1" href="#Accessing-the-Data-Cube-1">Accessing the Data Cube</a></h1><h2><a class="nav-anchor" id="Open-a-datacube-1" href="#Open-a-datacube-1">Open a datacube</a></h2><p>Before one can read data from a cube, it has to be opened. To open a data cube which is accesible through the file system, use the <code>Cube</code> constructor:</p><pre><code class="language-julia">using CABLAB
c = Cube(&quot;/patch/to/cube&quot;)</code></pre><pre><code class="language-none">CABLAB data cube at /Net/Groups/BGI/scratch/DataCube/v0.2.0/high-res/
Spatial resolution:  4320x2160 at 0.083333 degrees.
Temporal resolution: 2001-01-01T00:00:00 to 2012-01-01T00:00:00 at 8daily time steps
Variables:           aerosol_optical_thickness_1610 aerosol_optical_thickness_550 aerosol_optical_thickness_555 aerosol_optical_thickness_659 aerosol_optical_thickness_865 air_temperature_2m bare_soil_evaporation black_sky_albedo burnt_area c_emissions country_mask evaporation evaporative_stress fractional_snow_cover gross_primary_productivity interception_loss land_surface_temperature latent_energy net_ecosystem_exchange open_water_evaporation ozone potential_evaporation precipitation root_moisture sensible_heat snow_sublimation snow_water_equivalent soil_moisture surface_moisture terrestrial_ecosystem_respiration transpiration water_mask water_vapour white_sky_albedo</code></pre><p>This returns a <code>Cube</code> object that contains some basics information about the cube which is printed on the screen.</p><h2><a class="nav-anchor" id="Getting-a-data-handle-1" href="#Getting-a-data-handle-1">Getting a data handle</a></h2><div></div><div><pre><code class="language-julia">var=[&quot;c_emissions&quot;,&quot;air_temperature_2m&quot;]
time=(DateTime(&quot;2001-01-01&quot;),DateTime(&quot;2001-12-31&quot;))
cubedata = getCubeData(c,longitude=(30,31),latitude=(50,51),variable=var)</code></pre><pre><code class="language-none">Data Cube view with the following dimensions
Lon                 Axis with 4 Elements from 30.0 to 30.75
Lat                 Axis with 4 Elements from 51.0 to 50.25
Time                Axis with 506 Elements from 2001-01-01T00:00:00 to 2011-12-27T00:00:00
Variable            Axis with elements: c_emissions air_temperature_2m</code></pre></div><p>This returns a view into the Data Cube, on which further calculations can be applied. All keyword arguments default to the full range, so calling <code>getCubeData</code> without keyword arguments will return a view No data is read yet. Here you can start to do some calculations on your sub-cube, see either <a href="analysis.html#Analysis-1">Analysis</a> for a list of methods provided by this framework or <a href="adding_new.html#Applying-custom-functions-1">Applying custom functions</a> to apply your own functions on the cube. If you just want to visualize the cube see this section <a href="plotting.html#Plotting-1">Plotting</a>.</p><h2><a class="nav-anchor" id="Cube-Types-1" href="#Cube-Types-1">Cube Types</a></h2><p>In CABLAB, you will</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.Cubes.AbstractCubeData" href="#CABLAB.Cubes.AbstractCubeData"><code>CABLAB.Cubes.AbstractCubeData</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">AbstractCubeData{T,N}</code></pre><p>Supertype of all cubes. <code>T</code> is the data type of the cube and <code>N</code> the number of dimensions. Beware that an <code>AbstractCubeData</code> does not implement the <code>AbstractArray</code> interface. However, the <code>CABLAB</code> functions <a href="@ref"><code>mapCube</code></a>, <a href="@ref"><code>reduceCube</code></a>, <a href="@ref"><code>readCubeData</code></a>, <a href="@ref"><code>plotMAP</code></a> and <a href="@ref"><code>plotXY</code></a> will work on any subtype of <code>AbstractCubeData</code></p></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/Cubes/Cubes.jl#L10-L18">source</a><br/></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.Cubes.CubeMem" href="#CABLAB.Cubes.CubeMem"><code>CABLAB.Cubes.CubeMem</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">CubeMem{T,N} &lt;: AbstractCubeMem{T,N}</code></pre><p>An in-memory data cube. It is returned by applying <a href="@ref"><code>mapCube</code></a> when the output cube is small enough to fit in memory or by explicitly calling <code>readCubeData</code> on any type of cube.</p><p><strong>Fields</strong></p><ul><li><p><code>axes</code> a <code>Vector{CubeAxis}</code> containing the Axes of the Cube</p></li><li><p><code>data</code> N-D array containing the data</p></li><li><p><code>mask</code> N-D array containgin the mask</p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/Cubes/Cubes.jl#L63-L76">source</a><br/></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.CubeAPI.SubCube" href="#CABLAB.CubeAPI.SubCube"><code>CABLAB.CubeAPI.SubCube</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">immutable SubCube{T,C} &lt;: AbstractCubeData{T,4}</code></pre><p>A view into the data cube of a single variable. Is the type returned by the <code>mapCube</code> function.</p><p><strong>Fields</strong></p><ul><li><p><code>cube::C</code> Parent cube</p></li><li><p><code>variable</code> selected variable</p></li><li><p><code>sub_grid</code> representation of the subgrid indices</p></li><li><p><code>sub_times</code> representation of the selected time steps</p></li><li><p><code>lonAxis</code></p></li><li><p><code>latAxis</code></p></li><li><p><code>timeAxis</code></p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/CubeAPI/CubeAPI.jl#L194-L210">source</a><br/></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.CubeAPI.SubCubeV" href="#CABLAB.CubeAPI.SubCubeV"><code>CABLAB.CubeAPI.SubCubeV</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">immutable SubCubeV{T, C} &lt;: AbstractCubeData{T,4}</code></pre><p>A view into the data cube with multiple variables. Returned by the <code>mapCube</code> function.</p><p><strong>Fields</strong></p><ul><li><p><code>cube::C</code> Parent cube</p></li><li><p><code>variable</code> list of selected variables</p></li><li><p><code>sub_grid</code> representation of the subgrid indices</p></li><li><p><code>sub_times</code> representation of the selected time steps</p></li><li><p><code>lonAxis</code></p></li><li><p><code>latAxis</code></p></li><li><p><code>timeAxis</code></p></li><li><p><code>varAxis</code></p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/CubeAPI/CubeAPI.jl#L251-L268">source</a><br/></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.Cubes.TempCubes.TempCube" href="#CABLAB.Cubes.TempCubes.TempCube"><code>CABLAB.Cubes.TempCubes.TempCube</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">type TempCube{T,N} &lt;: AbstractCubeData{T,N}</code></pre><p>The main data structure for storing temporary results from cube operations. Is usually returned by <a href="@ref"><code>mapCube</code></a>, if the result is larger than <code>max_cache</code></p><p><strong>Fields</strong></p><ul><li><p><code>axes</code> a vector of <a href="cube_access.html#CABLAB.Cubes.Axes.CubeAxis"><code>CubeAxis</code></a> containing the axes</p></li><li><p><code>folder</code> folder containing the data</p></li><li><p><code>block_size</code> dimension of the files that the cube is split into</p></li></ul><p>Each <code>TempCube</code> is stored in a single <code>folder</code>, but can contain several files. The rule is that one file is small enough to be read into memory and the <code>block_size</code> determines the size and shape of each sub-file. This data structure is quite convenient for parrallel access, because different processes can write their results at the same time.</p></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/Cubes/TempCubes.jl#L9-L26">source</a><br/></section><h2><a class="nav-anchor" id="Cube-Axes-1" href="#Cube-Axes-1">Cube Axes</a></h2><p>Axes are an essential part of each Cube in CABLAB. Every dimension that a cube has is associated with an axis that stores the values of the dimension. For example, a <code>LatitudeAxis</code> will contains a field <code>values</code> representing the chosen latitudes. Similarly, a <code>VariableAxis</code> will contain a list of Variable names. Axes types are divided in categorical axes and axes represented by ranges. All of them are subtypes of the abstract type <code>CubeAxis</code>.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.Cubes.Axes.CubeAxis" href="#CABLAB.Cubes.Axes.CubeAxis"><code>CABLAB.Cubes.Axes.CubeAxis</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">abstract CubeAxis{T} &lt;: AbstractCubeData{T,1}</code></pre><p>Supertype of all axes. Every <code>CubeAxis</code> is 1D Cube itself and can be passed to mapCube operationes. Although all cube axes are instances of the parametric typealias <a href="cube_access.html#CABLAB.Cubes.Axes.CategoricalAxis"><code>CategoricalAxis</code></a> and <a href="cube_access.html#CABLAB.Cubes.Axes.RangeAxis"><code>RangeAxis</code></a>, there are some typealiases defined to provide shorter and more convenient names for commonly used cube axes. Here is a list of the aliases:</p><p><strong>Categorical Axes</strong></p><ul><li><p><code>VariableAxis</code> represents different variables</p></li><li><p><code>SpatialPointAxis</code> represents a list of coordinates</p></li><li><p><code>CountryAxis</code> countries</p></li><li><p><code>TimeScaleAxis</code> time scales after time series decomposition</p></li><li><p><code>QuantileAxis</code> represents different quantiles</p></li></ul><p><strong>Cotinuous Axes</strong></p><ul><li><p><code>LonAxis</code> longitudes</p></li><li><p><code>LatAxis</code> latitudes</p></li><li><p><code>TimeAxis</code> time</p></li><li><p><code>MSCAxis</code> time step inside a year (for seasonal statistics)</p></li></ul></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/Cubes/Axes.jl#L57-L81">source</a><br/></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.Cubes.Axes.CategoricalAxis" href="#CABLAB.Cubes.Axes.CategoricalAxis"><code>CABLAB.Cubes.Axes.CategoricalAxis</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">CategoricalAxis{T,S}</code></pre><p>To represent axes that are categorical, where <code>T</code> is the element type. The type parameter <code>S</code> denotes the axis name (a symbol). The default constructor is:</p><pre><code class="language-none">CategoricalAxis(axname::String,values::Vector{T})</code></pre></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/Cubes/Axes.jl#L84-L93">source</a><br/></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.Cubes.Axes.RangeAxis" href="#CABLAB.Cubes.Axes.RangeAxis"><code>CABLAB.Cubes.Axes.RangeAxis</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">RangeAxis{T,S,R}</code></pre><p>To represent axes that are categorical, where <code>T</code> is the element type. The type parameter <code>S</code> denotes the axis name (a symbol) and <code>R</code> the type of the range which is used to represent the axis values. The default constructor is:</p><pre><code class="language-none">RangeAxis(axname::String,values::Range{T})</code></pre></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/Cubes/Axes.jl#L108-L118">source</a><br/></section><h2><a class="nav-anchor" id="Cube-Masks-1" href="#Cube-Masks-1">Cube Masks</a></h2><p>Every data cube type in CABLAB contains has a representation for the mask, which has the primary purpose of describing missing values and the reason for missingness. CABLAB masks are represented as <code>UInt8</code>-arrays, where each value can be one of the following:</p><ul><li><p><code>VALID</code> a regular data entry</p></li><li><p><code>MISSING</code> classical missing value</p></li><li><p><code>OCEAN</code> masked out by the land-sea mask</p></li><li><p><code>OUTOFPERIOD</code> current time step is not inside the measurement period</p></li><li><p><code>FILLED</code> does not count as missing, but still denotes that the value is gap filled and not measured</p></li></ul><p>These names can be imported by <code>using CABLAB.Mask</code>. The user can decide if he wants to use the masks in his analyses or rather wants to refer to a different representation with <code>NullableArray</code>s or just representing missings with <code>NaN</code>s. See <a href="adding_new.html#registerDATFunction-1">registerDATFunction</a> for details.</p><h2><a class="nav-anchor" id="Opening-Remote-Data-Cubes-1" href="#Opening-Remote-Data-Cubes-1">Opening Remote Data Cubes</a></h2><p>If you just want to try the CABLAB data cube and don&#39;t have access to the full data set, you can open a remote cube through a THREDDS server. All you need is a working internet connection to do this:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.CubeAPI.RemoteCube" href="#CABLAB.CubeAPI.RemoteCube"><code>CABLAB.CubeAPI.RemoteCube</code></a> — <span class="docstring-category">Type</span>.</div><div><p>Represents a remote data cube accessible through THREDDS. The default constructor is</p><p>RemoteCube(base_url)</p><p>where <code>base_url</code> is the datacube&#39;s base url.</p><p><strong>Fields</strong></p><ul><li><p><code>base_url</code> the cube parent directory</p></li><li><p><code>var_name_to_var_index</code> basically the inverse of <code>dataset_files</code></p></li><li><p><code>dataset_files</code> a list of datasets in the cube</p></li><li><p><code>dataset_paths</code> a list of urls pointing to the different data sets</p></li><li><p><code>config</code> the cube&#39;s static configuration <a href="@ref"><code>CubeConfig</code></a></p></li></ul><pre><code class="language-">using CABLAB
ds=remoteCube()</code></pre></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/CubeAPI/CubeAPI.jl#L119-L139">source</a><br/></section><p>This will open the remote cube and calling <code>getCubeData</code> will return a cube view that you can process.</p><p><strong>Important</strong> In order to avoid unnecessary traffic, be nice to our servers. Please use this only for testing the cube software for very limited amount of data (reading maps at single time steps) or time series in lon-lat boxes of size 1degx1deg.</p><h2><a class="nav-anchor" id="Point-wise-access-1" href="#Point-wise-access-1">Point-wise access</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CABLAB.Proc.CubeIO.sampleLandPoints" href="#CABLAB.Proc.CubeIO.sampleLandPoints"><code>CABLAB.Proc.CubeIO.sampleLandPoints</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-none">sampleLandPoints(cube, nsample;nomissing=false)</code></pre><p>Get an area-weighted sample from all non-ocean grid cells. This will return a new Cube where the <code>LonAxis</code> and <code>LatAxis</code> are condensed into a single <code>SpatialPointAxis</code> of length <code>nsample</code>. If <code>nomissing=true</code> only grid cells will be selected which don&#39;t contain any missing values. This makes sense for gap-filled cubes to make sure that grid cells with systematic seasonal gaps are not selected in the sample. </p></div><a class="source-link" target="_blank" href="https://github.com/CAB-LAB/CABLAB.jl/tree/d6ae6f768f29344ad9391a278b000fe46e2155d8/src/Proc/CubeIO.jl#L65-L73">source</a><br/></section><footer><hr/><a class="previous" href="thecube.html"><span class="direction">Previous</span><span class="title">The CABLAB Data Cube</span></a><a class="next" href="analysis.html"><span class="direction">Next</span><span class="title">Analysis</span></a></footer></article></body></html>
